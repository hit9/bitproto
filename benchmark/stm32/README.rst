bitproto benchmark on STM32
===========================

This directory contains a simple benchmark for bitproto encoding and decoding on STM32.

The project `bpbench <bpbench>`_ is based on code generated by
`stm32cubemx <https://www.st.com/en/development-tools/stm32cubemx.html>`_ ,
tested on microcontrollers: `stm32f103zet6 <https://www.st.com/en/microcontrollers-microprocessors/stm32f103ze.html>`_
and `stm32f103ve6 <https://www.st.com/en/microcontrollers-microprocessors/stm32f103ve.html>`_.

Benchmark result
----------------

* Microcontroller: `**STM32F103ZE** <https://www.st.com/en/microcontrollers-microprocessors/stm32f103ze.html>`_,
  Arm Cortex-M3 MCU, 72 MHz
* bitproto file: `drone.bitproto <drone.bitproto>`_.

Standard Mode
^^^^^^^^^^^^^

The "standard mode" means to run bitproto compiler **without**
the optimization mode flag ``-O``, that is to use `the bitproto c lib <../../lib/c>`_.

.. list-table::
   :header-rows: 1

   * - GCC Optimization Flag
     - Number of calls
     - Encode cost per call
     - Decode cost per call
   * - None
     - 10000
     - 170μs
     - 163μs
   * - ``-O2``
     - 10000
     - 135μs
     - 131μs
   * - ``-O3``
     - 10000
     - 127μs
     - 119μs

Optimization Mode
^^^^^^^^^^^^^^^^^

The "standard mode" means to run bitproto compiler **with**
the optimization mode flag ``-O``, that is not to use `the bitproto c lib <../../lib/c>`_.

.. list-table::
   :header-rows: 1

   * - GCC Optimization Flag
     - Number of calls
     - Encode cost per call
     - Decode cost per call
   * - None
     - 10000
     - 9μs
     - 9μs
   * - ``-O2``
     - 10000
     - 9μs
     - 9μs
